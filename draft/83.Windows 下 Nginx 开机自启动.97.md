# 83.Windows 下 Nginx 开机自启动.97

## <a name="start"></a> 引子
最近经常用到 Nginx ，每次开机要重新启动一下，想设置为开机自动执行 `start nginx`。找了下资料。

系统：Windows 10 家庭中文版
版本号：20H2
操作系统版本：19042.685
nginx：1.18.0 ，只配置端口和 root 字段。

## <a name="title1"></a> 解决方式
Windows 可以通过手动修改注册表设置启动项，感觉有些麻烦，还是找个工具。找到工具 [WinSW][url-github-1]，它可以将任何应用包裹并作为一个 Windows 服务管理。在[这里][url-github-2]可以下载编译好的可执行文件。本次使用的版本是 WinSW v3.0.0-alpha.7 。

WinSW 作为一个全局工具使用：
1. 下载 WinSW.exe 或 WinSW.zip。
2. 新建 myapp.xml （更详细见[文档][url-github-3]和[示例][url-github-4]）。
3. 运行 `winsw install myapp.xml [options]` 安装服务。
4. 运行 `winsw start myapp.xml` 开启服务。
5. 运行 `winsw status myapp.xml` 检查服务是否启动和运行。

在实际操作过程中发现了其它注意点：
- 输入命令时参数 `myapp.xml` 并不是必需，想要简化，配置文件名称跟 WinSW.exe 文件的名称一致即可，否则不带配置文件名称参数会报错。
- WinSW.exe 文件需要放置在 nginx 安装目录下，否则执行指令的时候会提示找不到 nginx 的配置文件。
- 出错误的时候，会输出日志，看日志有助于排查问题。

下面是个人配置步骤示例。
### 第 1 步
将下载的 exe 文件移动到 nginx 目录下，重命名为 winsw.ext ,新建配置文件 winsw.xml ，写入下面的配置：
```
<service>
  <id>nginx service</id>
  <name>Nginx</name>
  <description>This service runs Nginx.</description>
  <env name="NGINX_COMIC" value="%BASE%" />
  <prestart>start D:\nginx-1.18.0\nginx.exe</prestart>
  <executable>D:\nginx-1.18.0\nginx.exe</executable>
  <prestop>D:\nginx-1.18.0\nginx.exe -s stop</prestop>
  <log mode="roll" />
  <onfailure action="none" />
</service>
```

### 第 2 步
在当前路径下打开命令窗口（当前文件路径上输入 cmd 回车即可）,执行命令：
```
winsw install
```
出现下面的提示：


查看是否成功添加了服务，“此电脑”右键 -> “管理” -> “服务和应用程序” -> “服务”：

### 第 3 步
启动服务：
```
winsw start
```
启动成功也会出现提示。访问确认 nginx 启动成功后，重启电脑，看下是否会自启动。


## <a name="reference"></a> 参考资料
- [Window下将nginx配置为开机自动启动][url-article-1]
- [winsw Github][url-github-1]


[url-github-1]:https://github.com/winsw/winsw
[url-github-2]:https://github.com/winsw/winsw/releases
[url-github-3]:https://github.com/winsw/winsw/blob/v3/docs/xml-config-file.md
[url-github-4]:https://github.com/winsw/winsw/tree/v3/samples
[url-article-1]:https://www.cnblogs.com/mobingfeng/p/12779163.html

[url-local-5]:../images/n/help.png

<details>
<summary>:wastebasket:</summary>


![n-poster][url-local-poster]

</details>

[url-book]:https://book.douban.com/subject/26916012/
[url-local-poster]:../images/n/poster.jpg
